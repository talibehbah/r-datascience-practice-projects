# Exploratory Data Analysis
head(Caravan)
# =============================================================================
# PROJECT: CARAVAN INSURANCE PURCHASE PREDICTION USING KNN
# =============================================================================
# Load required libraries
library(class)
library(ISLR2)
# Load Caravan dataset
data(Caravan)
# Exploratory Data Analysis
head(Caravan)
cat("=== DATA SUMMARY ===\n")
summary(Caravan$Purchase)
# Check for missing values
cat("\n=== MISSING VALUES CHECK ===\n")
any(is.na(Caravan))
# Check variance of first two columns
cat("\n=== VARIANCE CHECK ===\n")
cat("Variance of column 1:", var(Caravan[,1]), "\n")
cat("Variance of column 2:", var(Caravan[,2]), "\n")
# Standardize the variables
purchase <- Caravan[,86]
standardised.caravan <- scale(Caravan[,-86])
cat("\n=== VARIANCE AFTER STANDARDIZATION ===\n")
cat("Variance of standardized column 1:", var(standardised.caravan[,1]), "\n")
cat("Variance of standardized column 2:", var(standardised.caravan[,2]), "\n")
# Split data (first 1000 for testing)
test.index <- 1:1000
test.data <- standardised.caravan[test.index,]
test.purchase <- purchase[test.index]
# Training data
train.data <- standardised.caravan[-test.index,]
train.purchase <- purchase[-test.index]
cat("\n=== DATA SPLIT ===\n")
cat("Training data size:", nrow(train.data), "\n")
cat("Testing data size:", nrow(test.data), "\n")
# KNN Model with k=9
set.seed(101)
predicted.purchase <- knn(train.data, test.data, train.purchase, k = 9)
cat("\n=== KNN PREDICTIONS (FIRST 10) ===\n")
print(head(predicted.purchase, 10))
# Calculate misclassification error
misclass.error <- mean(test.purchase != predicted.purchase)
cat("\n=== MODEL PERFORMANCE ===\n")
cat("Misclassification Error (k=9):", misclass.error, "\n")
# Find optimal k value using elbow method
predicted.purchase <- NULL
error.rate <- NULL
for (i in 1:20) {
set.seed(101)
predicted.purchase <- knn(train.data, test.data, train.purchase, k = i)
error.rate[i] <- mean(test.purchase != predicted.purchase)
}
# Create error rate dataframe
k.values <- 1:20
error.df <- data.frame(k.values, error.rate)
cat("\n=== ERROR RATES FOR DIFFERENT K VALUES ===\n")
print(error.df)
# Visualize error rates vs k values
library(ggplot2)
ggplot(data = error.df, aes(x = k.values, y = error.rate)) +
geom_point() +
geom_line(linetype = "dotted", color = "red") +
labs(title = "KNN Error Rate vs K Value",
x = "K Value", y = "Error Rate") +
theme_minimal()
# Find optimal k (minimum error rate)
optimal.k <- which.min(error.rate)
cat("\n=== OPTIMAL K VALUE ===\n")
cat("Optimal k:", optimal.k, "with error rate:", error.rate[optimal.k], "\n")
# Run KNN with optimal k
set.seed(101)
final.prediction <- knn(train.data, test.data, train.purchase, k = optimal.k)
final.error <- mean(test.purchase != final.prediction)
cat("\nFinal model error rate with k =", optimal.k, ":", final.error, "\n")
